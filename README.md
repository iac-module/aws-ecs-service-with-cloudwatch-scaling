# aws-ecs-service-with-cloudwatch-scaling
This is a compiled terraform module capable of creating:
- AWS ecs service 
- metric_alerm

The purpose of this module reason is able to configure custom scaling policy based on cloudwatch metrics

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.7.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.38.0 |

## Providers

No providers.

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_ecs_service"></a> [ecs\_service](#module\_ecs\_service) | git::https://github.com/terraform-aws-modules/terraform-aws-ecs.git//modules/service | a35b5c8e0c06dd2785b73e6f810602a66b13bd4f |
| <a name="module_metric_alerm_1"></a> [metric\_alerm\_1](#module\_metric\_alerm\_1) | git::https://github.com/terraform-aws-modules/terraform-aws-cloudwatch.git//modules/metric-alarm | af2b377591105fc50522cb202b93eef17cb1bcaa |
| <a name="module_metric_alerm_2"></a> [metric\_alerm\_2](#module\_metric\_alerm\_2) | git::https://github.com/terraform-aws-modules/terraform-aws-cloudwatch.git//modules/metric-alarm | af2b377591105fc50522cb202b93eef17cb1bcaa |

## Resources

No resources.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_ecs_service"></a> [ecs\_service](#input\_ecs\_service) | ECS Service variables | <pre>object({<br>    create                                  = optional(bool, true)<br>    tags                                    = optional(map(string), {})<br>    ignore_task_definition_changes          = optional(bool, false)<br>    alarms                                  = optional(any, {})<br>    capacity_provider_strategy              = optional(any, {})<br>    cluster_arn                             = optional(string, "")<br>    deployment_circuit_breaker              = optional(any, {})<br>    deployment_controller                   = optional(any, {})<br>    deployment_maximum_percent              = optional(number, 200)<br>    deployment_minimum_healthy_percent      = optional(number, 66)<br>    desired_count                           = optional(number, 1)<br>    enable_ecs_managed_tags                 = optional(bool, true)<br>    enable_execute_command                  = optional(bool, true)<br>    force_new_deployment                    = optional(bool, true)<br>    health_check_grace_period_seconds       = optional(number, null)<br>    launch_type                             = optional(string, "FARGATE")<br>    load_balancer                           = optional(any, {})<br>    name                                    = optional(string, null)<br>    assign_public_ip                        = optional(bool, false)<br>    security_group_ids                      = optional(list(string), [])<br>    subnet_ids                              = optional(list(string), [])<br>    ordered_placement_strategy              = optional(any, {})<br>    placement_constraints                   = optional(any, {})<br>    platform_version                        = optional(string, null)<br>    propagate_tags                          = optional(string, null)<br>    scheduling_strategy                     = optional(string, null)<br>    service_connect_configuration           = optional(any, {})<br>    service_registries                      = optional(any, {})<br>    timeouts                                = optional(map(string), {})<br>    triggers                                = optional(any, {})<br>    wait_for_steady_state                   = optional(bool, null)<br>    service_tags                            = optional(map(string), {})<br>    create_iam_role                         = optional(bool, true)<br>    iam_role_arn                            = optional(string, null)<br>    iam_role_name                           = optional(string, null)<br>    iam_role_use_name_prefix                = optional(bool, true)<br>    iam_role_path                           = optional(string, null)<br>    iam_role_description                    = optional(string, null)<br>    iam_role_permissions_boundary           = optional(string, null)<br>    iam_role_tags                           = optional(map(string), {})<br>    iam_role_statements                     = optional(any, {})<br>    create_task_definition                  = optional(bool, true)<br>    task_definition_arn                     = optional(string, null)<br>    container_definitions                   = optional(any, {})<br>    container_definition_defaults           = optional(any, {})<br>    cpu                                     = optional(number, 1024)<br>    ephemeral_storage                       = optional(any, {})<br>    family                                  = optional(string, null)<br>    inference_accelerator                   = optional(any, {})<br>    ipc_mode                                = optional(string, null)<br>    memory                                  = optional(number, 2048)<br>    network_mode                            = optional(string, "awsvpc")<br>    pid_mode                                = optional(string, null)<br>    task_definition_placement_constraints   = optional(any, {})<br>    proxy_configuration                     = optional(any, {})<br>    requires_compatibilities                = optional(list(string), ["FARGATE"])<br>    runtime_platform                        = optional(any, {})<br>    skip_destroy                            = optional(bool, null)<br>    volume                                  = optional(any, {})<br>    task_tags                               = optional(map(string), {})<br>    create_task_exec_iam_role               = optional(bool, true)<br>    task_exec_iam_role_arn                  = optional(string, null)<br>    task_exec_iam_role_name                 = optional(string, null)<br>    task_exec_iam_role_use_name_prefix      = optional(bool, true)<br>    task_exec_iam_role_path                 = optional(string, null)<br>    task_exec_iam_role_description          = optional(string, null)<br>    task_exec_iam_role_permissions_boundary = optional(string, null)<br>    task_exec_iam_role_tags                 = optional(map(string), {})<br>    task_exec_iam_role_policies             = optional(map(string), {})<br>    create_task_exec_policy                 = optional(bool, true)<br>    task_exec_ssm_param_arns                = optional(list(string), ["arn:aws:ssm:*:*:parameter/*"])<br>    task_exec_secret_arns                   = optional(list(string), ["arn:aws:secretsmanager:*:*:secret:*"])<br>    task_exec_iam_statements                = optional(any, {})<br>    create_tasks_iam_role                   = optional(bool, true)<br>    tasks_iam_role_arn                      = optional(string, null)<br>    tasks_iam_role_name                     = optional(string, null)<br>    tasks_iam_role_use_name_prefix          = optional(bool, true)<br>    tasks_iam_role_path                     = optional(string, null)<br>    tasks_iam_role_description              = optional(string, null)<br>    tasks_iam_role_permissions_boundary     = optional(string, null)<br>    tasks_iam_role_tags                     = optional(map(string), {})<br>    tasks_iam_role_policies                 = optional(map(string), {})<br>    tasks_iam_role_statements               = optional(any, {})<br>    external_id                             = optional(string, null)<br>    scale                                   = optional(any, {})<br>    force_delete                            = optional(bool, null)<br>    wait_until_stable                       = optional(bool, null)<br>    wait_until_stable_timeout               = optional(string, null)<br>    enable_autoscaling                      = optional(bool, true)<br>    autoscaling_min_capacity                = optional(number, 1)<br>    autoscaling_max_capacity                = optional(number, 10)<br>    autoscaling_policies = optional(any, {<br>      cpu = {<br>        policy_type = "TargetTrackingScaling"<br><br>        target_tracking_scaling_policy_configuration = {<br>          predefined_metric_specification = {<br>            predefined_metric_type = "ECSServiceAverageCPUUtilization"<br>          }<br>        }<br>      }<br>      memory = {<br>        policy_type = "TargetTrackingScaling"<br><br>        target_tracking_scaling_policy_configuration = {<br>          predefined_metric_specification = {<br>            predefined_metric_type = "ECSServiceAverageMemoryUtilization"<br>          }<br>        }<br>      }<br>    })<br>    autoscaling_scheduled_actions  = optional(any, {})<br>    create_security_group          = optional(bool, true)<br>    security_group_name            = optional(string, null)<br>    security_group_use_name_prefix = optional(bool, true)<br>    security_group_description     = optional(string, null)<br>    security_group_rules           = optional(any, {})<br>    security_group_tags            = optional(map(string), {})<br>  })</pre> | n/a | yes |
| <a name="input_metric_alarm_1"></a> [metric\_alarm\_1](#input\_metric\_alarm\_1) | Metric-alarm resource | <pre>object({<br>    create_metric_alarm                   = optional(bool, true)<br>    alarm_name                            = optional(string, "default")<br>    alarm_description                     = optional(string, null)<br>    comparison_operator                   = optional(string, "GreaterThanOrEqualToThreshold")<br>    evaluation_periods                    = optional(number, 1)<br>    threshold                             = optional(number, null)<br>    threshold_metric_id                   = optional(string, null)<br>    unit                                  = optional(string, null)<br>    metric_name                           = optional(string, null)<br>    namespace                             = optional(string, null)<br>    period                                = optional(string, null)<br>    statistic                             = optional(string, null)<br>    actions_enabled                       = optional(bool, true)<br>    datapoints_to_alarm                   = optional(number, null)<br>    dimensions                            = optional(any, null)<br>    alarm_actions                         = optional(list(string), null)<br>    insufficient_data_actions             = optional(list(string), null)<br>    ok_actions                            = optional(list(string), null)<br>    extended_statistic                    = optional(string, null)<br>    treat_missing_data                    = optional(string, "missing")<br>    evaluate_low_sample_count_percentiles = optional(string, null)<br>    metric_query                          = optional(any, [])<br>    tags                                  = optional(map(string), {})<br>    autoscaling_policies_id               = optional(string, "1")<br>  })</pre> | <pre>{<br>  "create_metric_alarm": false<br>}</pre> | no |
| <a name="input_metric_alarm_2"></a> [metric\_alarm\_2](#input\_metric\_alarm\_2) | Metric-alarm resource | <pre>object({<br>    create_metric_alarm                   = optional(bool, false)<br>    alarm_name                            = optional(string, "default")<br>    alarm_description                     = optional(string, null)<br>    comparison_operator                   = optional(string, "GreaterThanOrEqualToThreshold")<br>    evaluation_periods                    = optional(number, 1)<br>    threshold                             = optional(number, null)<br>    threshold_metric_id                   = optional(string, null)<br>    unit                                  = optional(string, null)<br>    metric_name                           = optional(string, null)<br>    namespace                             = optional(string, null)<br>    period                                = optional(string, null)<br>    statistic                             = optional(string, null)<br>    actions_enabled                       = optional(bool, true)<br>    datapoints_to_alarm                   = optional(number, null)<br>    dimensions                            = optional(any, null)<br>    alarm_actions                         = optional(list(string), null)<br>    insufficient_data_actions             = optional(list(string), null)<br>    ok_actions                            = optional(list(string), null)<br>    extended_statistic                    = optional(string, null)<br>    treat_missing_data                    = optional(string, "missing")<br>    evaluate_low_sample_count_percentiles = optional(string, null)<br>    metric_query                          = optional(any, [])<br>    tags                                  = optional(map(string), {})<br>    autoscaling_policies_id               = optional(string, "2")<br>  })</pre> | <pre>{<br>  "create_metric_alarm": false<br>}</pre> | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_autoscaling_policies"></a> [autoscaling\_policies](#output\_autoscaling\_policies) | Map of autoscaling policies and their attributes |
| <a name="output_autoscaling_scheduled_actions"></a> [autoscaling\_scheduled\_actions](#output\_autoscaling\_scheduled\_actions) | Map of autoscaling scheduled actions and their attributes |
| <a name="output_cloudwatch_metric_alarm_1_arn"></a> [cloudwatch\_metric\_alarm\_1\_arn](#output\_cloudwatch\_metric\_alarm\_1\_arn) | The ARN of the Cloudwatch metric alarm. |
| <a name="output_cloudwatch_metric_alarm_1_id"></a> [cloudwatch\_metric\_alarm\_1\_id](#output\_cloudwatch\_metric\_alarm\_1\_id) | The ID of the Cloudwatch metric alarm. |
| <a name="output_cloudwatch_metric_alarm_2_arn"></a> [cloudwatch\_metric\_alarm\_2\_arn](#output\_cloudwatch\_metric\_alarm\_2\_arn) | The ARN of the Cloudwatch metric alarm. |
| <a name="output_cloudwatch_metric_alarm_2_id"></a> [cloudwatch\_metric\_alarm\_2\_id](#output\_cloudwatch\_metric\_alarm\_2\_id) | The ID of the Cloudwatch metric alarm. |
| <a name="output_container_definitions"></a> [container\_definitions](#output\_container\_definitions) | Container definitions |
| <a name="output_iam_role_arn"></a> [iam\_role\_arn](#output\_iam\_role\_arn) | Service IAM role ARN |
| <a name="output_iam_role_name"></a> [iam\_role\_name](#output\_iam\_role\_name) | Service IAM role name |
| <a name="output_iam_role_unique_id"></a> [iam\_role\_unique\_id](#output\_iam\_role\_unique\_id) | Stable and unique string identifying the service IAM role |
| <a name="output_id"></a> [id](#output\_id) | ARN that identifies the service |
| <a name="output_name"></a> [name](#output\_name) | Name of the service |
| <a name="output_security_group_arn"></a> [security\_group\_arn](#output\_security\_group\_arn) | Amazon Resource Name (ARN) of the security group |
| <a name="output_security_group_id"></a> [security\_group\_id](#output\_security\_group\_id) | ID of the security group |
| <a name="output_task_definition_arn"></a> [task\_definition\_arn](#output\_task\_definition\_arn) | Full ARN of the Task Definition (including both `family` and `revision`) |
| <a name="output_task_definition_family"></a> [task\_definition\_family](#output\_task\_definition\_family) | The unique name of the task definition |
| <a name="output_task_definition_revision"></a> [task\_definition\_revision](#output\_task\_definition\_revision) | Revision of the task in a particular family |
| <a name="output_task_exec_iam_role_arn"></a> [task\_exec\_iam\_role\_arn](#output\_task\_exec\_iam\_role\_arn) | Task execution IAM role ARN |
| <a name="output_task_exec_iam_role_name"></a> [task\_exec\_iam\_role\_name](#output\_task\_exec\_iam\_role\_name) | Task execution IAM role name |
| <a name="output_task_exec_iam_role_unique_id"></a> [task\_exec\_iam\_role\_unique\_id](#output\_task\_exec\_iam\_role\_unique\_id) | Stable and unique string identifying the task execution IAM role |
| <a name="output_task_set_arn"></a> [task\_set\_arn](#output\_task\_set\_arn) | The Amazon Resource Name (ARN) that identifies the task set |
| <a name="output_task_set_id"></a> [task\_set\_id](#output\_task\_set\_id) | The ID of the task set |
| <a name="output_task_set_stability_status"></a> [task\_set\_stability\_status](#output\_task\_set\_stability\_status) | The stability status. This indicates whether the task set has reached a steady state |
| <a name="output_task_set_status"></a> [task\_set\_status](#output\_task\_set\_status) | The status of the task set |
| <a name="output_tasks_iam_role_arn"></a> [tasks\_iam\_role\_arn](#output\_tasks\_iam\_role\_arn) | Tasks IAM role ARN |
| <a name="output_tasks_iam_role_name"></a> [tasks\_iam\_role\_name](#output\_tasks\_iam\_role\_name) | Tasks IAM role name |
| <a name="output_tasks_iam_role_unique_id"></a> [tasks\_iam\_role\_unique\_id](#output\_tasks\_iam\_role\_unique\_id) | Stable and unique string identifying the tasks IAM role |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
